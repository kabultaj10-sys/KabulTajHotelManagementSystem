{% extends 'base.html' %}
{% load static %}

{% block title %}Restaurant Billing Dashboard - Kabul Taj Hotel{% endblock %}
{% block page_title %}Restaurant Billing Dashboard{% endblock %}
{% block page_subtitle %}Restaurant Billing Management{% endblock %}

{% block content %}
<div class="billing-dashboard">
    <!-- Header Section -->
    <div class="billing-header">
        <div class="billing-header-content">
            <div class="billing-title">
                <h1>Restaurant Billing Dashboard</h1>
                <p>Manage restaurant invoices, track payments, and monitor revenue</p>
            </div>
            <div class="billing-actions">
                <a href="{% url 'restaurant:invoice_create' %}" class="btn btn-primary btn-create">
                    <i class="fas fa-plus"></i>
                    Create Invoice
                </a>
                <a href="{% url 'restaurant:invoice_list' %}" class="btn btn-outline">
                    <i class="fas fa-list"></i>
                    View All Invoices
                </a>
            </div>
        </div>
    </div>

    <!-- Stats Grid -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon stat-icon-success">
                <i class="fas fa-file-invoice"></i>
            </div>
            <div class="stat-content">
                <h3>Total Invoices</h3>
                <div class="stat-number">{{ total_invoices }}</div>
                <div class="stat-subtitle">All restaurant invoices</div>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon stat-icon-warning">
                <i class="fas fa-clock"></i>
            </div>
            <div class="stat-content">
                <h3>Pending Invoices</h3>
                <div class="stat-number">{{ pending_invoices }}</div>
                <div class="stat-subtitle">Awaiting payment</div>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon stat-icon-danger">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <div class="stat-content">
                <h3>Overdue Invoices</h3>
                <div class="stat-number">{{ overdue_invoices }}</div>
                <div class="stat-subtitle">Past due date</div>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon stat-icon-gold">
                <i class="fas fa-dollar-sign"></i>
            </div>
            <div class="stat-content">
                <h3>Total Revenue</h3>
                <div class="stat-number">${{ total_revenue|floatformat:2 }}</div>
                <div class="stat-subtitle">Restaurant earnings</div>
            </div>
        </div>
    </div>

    <!-- Recent Invoices Section -->
    <div class="transactions-section">
        <div class="transactions-header">
            <div class="transactions-title">
                <h3>Recent Invoices</h3>
                <p>Latest restaurant invoice activities</p>
            </div>
            <a href="{% url 'restaurant:invoice_list' %}" class="btn btn-outline">
                View All
                <i class="fas fa-arrow-right"></i>
            </a>
        </div>
        
        <div class="transactions-table-container">
            <table class="transactions-table">
                <thead>
                    <tr>
                        <th>Invoice #</th>
                        <th>Customer</th>
                        <th>Order #</th>
                        <th>Amount</th>
                        <th>Status</th>
                        <th>Date</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for invoice in recent_invoices %}
                    <tr>
                        <td>
                            <div class="invoice-id">
                                <a href="{% url 'restaurant:invoice_detail' invoice.pk %}">
                                    {{ invoice.invoice_number }}
                                </a>
                            </div>
                        </td>
                        <td>
                            <div class="customer-info">
                                <div class="customer-name">{{ invoice.customer_name }}</div>
                            </div>
                        </td>
                        <td>
                            <div class="order-number">{{ invoice.order.order_number }}</div>
                        </td>
                        <td>
                            <div class="amount">${{ invoice.total_amount|floatformat:2 }}</div>
                        </td>
                        <td>
                            <span class="status-badge status-{{ invoice.status }}">
                                {{ invoice.get_status_display }}
                            </span>
                        </td>
                        <td>
                            <div class="date">{{ invoice.created_at|date:"M d, Y" }}</div>
                        </td>
                        <td>
                            <div class="table-actions">
                                <a href="{% url 'restaurant:invoice_detail' invoice.pk %}" class="btn-icon" title="View Details">
                                    <i class="fas fa-eye"></i>
                                </a>
                                <a href="{% url 'restaurant:invoice_edit' invoice.pk %}" class="btn-icon" title="Edit">
                                    <i class="fas fa-edit"></i>
                                </a>
                                <a href="{% url 'restaurant:invoice_print' invoice.pk %}" class="btn-icon" title="Print">
                                    <i class="fas fa-print"></i>
                                </a>
                            </div>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="7">
                            <div class="empty-state">
                                <div class="empty-icon">
                                    <i class="fas fa-receipt"></i>
                                </div>
                                <h3>No invoices found</h3>
                                <p>Get started by creating your first restaurant invoice.</p>
                                <a href="{% url 'restaurant:invoice_create' %}" class="btn btn-primary">
                                    <i class="fas fa-plus"></i>
                                    Create Invoice
                                </a>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Overdue Invoices Section -->
    {% if overdue_invoices_list %}
    <div class="transactions-section">
        <div class="transactions-header">
            <div class="transactions-title">
                <h3>Overdue Invoices</h3>
                <p>Invoices past their due date requiring attention</p>
                <span class="overdue-badge">{{ overdue_invoices_list|length }} overdue</span>
            </div>
        </div>
        
        <div class="transactions-table-container">
            <table class="transactions-table">
                <thead>
                    <tr>
                        <th>Invoice #</th>
                        <th>Customer</th>
                        <th>Order #</th>
                        <th>Amount</th>
                        <th>Due Date</th>
                        <th>Days Overdue</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for invoice in overdue_invoices_list %}
                    <tr class="overdue-row">
                        <td>
                            <div class="invoice-id">
                                <a href="{% url 'restaurant:invoice_detail' invoice.pk %}">
                                    {{ invoice.invoice_number }}
                                </a>
                            </div>
                        </td>
                        <td>
                            <div class="customer-info">
                                <div class="customer-name">{{ invoice.customer_name }}</div>
                            </div>
                        </td>
                        <td>
                            <div class="order-number">{{ invoice.order.order_number }}</div>
                        </td>
                        <td>
                            <div class="amount">${{ invoice.total_amount|floatformat:2 }}</div>
                        </td>
                        <td>
                            <div class="due-date">{{ invoice.due_date|date:"M d, Y" }}</div>
                        </td>
                        <td>
                            <div class="overdue-days">
                                <span class="overdue-text">{{ invoice.due_date|timesince }}</span>
                            </div>
                        </td>
                        <td>
                            <div class="table-actions">
                                <a href="{% url 'restaurant:invoice_detail' invoice.pk %}" class="btn-icon" title="View Details">
                                    <i class="fas fa-eye"></i>
                                </a>
                                <a href="{% url 'restaurant:invoice_edit' invoice.pk %}" class="btn-icon" title="Edit">
                                    <i class="fas fa-edit"></i>
                                </a>
                                <a href="{% url 'restaurant:invoice_print' invoice.pk %}" class="btn-icon" title="Print">
                                    <i class="fas fa-print"></i>
                                </a>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
