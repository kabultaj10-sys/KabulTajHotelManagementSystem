{% extends 'base.html' %}
{% load static %}

{% block title %}Receipt {{ invoice.invoice_number }}{% endblock %}

{% block content %}
<div class="no-print" style="display:flex; gap: var(--spacing-sm); justify-content:center; margin-bottom: var(--spacing-md);">
  <button onclick="window.print()" class="btn btn-primary"><i class="fas fa-print"></i> Print Receipt</button>
  <a href="{% url 'restaurant:invoice_detail' invoice.pk %}" class="btn btn-outline"><i class="fas fa-eye"></i> View Invoice</a>
  <a href="{% url 'restaurant:invoice_list' %}" class="btn btn-outline"><i class="fas fa-list"></i> All Invoices</a>
  <a href="{% url 'restaurant:invoice_print' invoice.pk %}" class="btn btn-secondary"><i class="fas fa-file"></i> Full A4 Print</a>
  </div>

<div class="receipt">
  <div class="receipt-header">
    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
      <img src="{% static 'kabultajLogo.png' %}" alt="Kabul Taj Hotel Logo" style="width: 40px; height: 40px; object-fit: contain;">
      <div class="hotel">Kabul Taj Hotel - Restaurant</div>
    </div>
    <div class="meta">Receipt: {{ invoice.invoice_number }}</div>
    <div class="meta">Date: {{ invoice.invoice_date|date:"Y-m-d H:i" }}</div>
  </div>

  <div class="line"></div>

  <div class="row">
    <div>Customer</div>
    <div>{{ invoice.customer_name }}</div>
  </div>
  <div class="row">
    <div>Order</div>
    <div>{{ invoice.order.order_number }}</div>
  </div>

  <div class="line"></div>

  <table class="items">
    <thead>
      <tr>
        <th style="text-align:left;">Item</th>
        <th>Qty</th>
        <th>Price</th>
        <th>Total</th>
      </tr>
    </thead>
    <tbody>
      {% for item in invoice.items.all %}
      <tr>
        <td style="text-align:left;">{{ item.description }}</td>
        <td>{{ item.quantity }}</td>
        <td>{{ item.unit_price|floatformat:2 }}</td>
        <td>{{ item.total_price|floatformat:2 }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <div class="line"></div>

  <div class="totals">
    <div class="row">
      <div>Subtotal</div>
      <div>{{ invoice.subtotal|floatformat:2 }}</div>
    </div>
    {% if invoice.tax_amount and invoice.tax_amount > 0 %}
    <div class="row">
      <div>Tax</div>
      <div>{{ invoice.tax_amount|floatformat:2 }}</div>
    </div>
    {% endif %}
    {% if invoice.discount_amount and invoice.discount_amount > 0 %}
    <div class="row">
      <div>Discount</div>
      <div>-{{ invoice.discount_amount|floatformat:2 }}</div>
    </div>
    {% endif %}
    <div class="row total">
      <div>Total</div>
      <div>{{ invoice.total_amount|floatformat:2 }}</div>
    </div>
  </div>

  <div class="footer">
    Thank you! No refunds without receipt.
  </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
  /* 2.9 inch receipt: 2.9in â‰ˆ 73.66mm */
  .receipt {
    width: 2.9in;
    margin: 0 auto;
    background: white;
    color: #111827;
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    font-size: 11px;
    line-height: 1.3;
    padding: 8px 10px;
    border: 1px dashed #e5e7eb;
  }
  .receipt-header { text-align: center; margin-bottom: 6px; }
  .hotel { font-weight: 700; }
  .meta { color: #6b7280; }
  .line { border-top: 1px dashed #9ca3af; margin: 6px 0; }
  .row { display: flex; justify-content: space-between; }
  table.items { width: 100%; border-collapse: collapse; }
  table.items th, table.items td { padding: 2px 0; text-align: right; }
  table.items thead th { border-bottom: 1px solid #d1d5db; font-weight: 700; }
  .totals .row { margin: 2px 0; }
  .totals .total { font-weight: 700; border-top: 1px dashed #9ca3af; margin-top: 4px; padding-top: 4px; }
  .footer { text-align: center; margin-top: 8px; color: #6b7280; }

  @media print {
    .no-print { display: none !important; }
    body { margin: 0; }
    @page { size: 2.9in auto; margin: 4mm; }
    .receipt { border: none; }
  }
</style>
{% endblock %}


