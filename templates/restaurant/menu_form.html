{% extends 'base.html' %}

{% block title %}{{ title }} - Kabul Taj Hotel{% endblock %}

{% block content %}
<div class="module-container">
    <div class="module">
        <!-- Enhanced Header -->
        <div class="form-header">
            <div class="header-main">
                <div class="header-content">
                    <h1 class="header-title">{{ title }}</h1>
                    <p class="header-subtitle">Restaurant Management - Add or update menu items</p>
                </div>
                <div class="header-actions">
                    <a href="{% url 'restaurant:menu_list' %}" class="btn btn-outline">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M19 12H5M12 19l-7-7 7-7"/>
                        </svg>
                        <span>Back to Menu</span>
                    </a>
                </div>
            </div>
        </div>

        <!-- Form Container -->
        <div class="form-container">
            <form method="post" enctype="multipart/form-data" class="menu-form">
                {% csrf_token %}
                
                <!-- Basic Information Section -->
                <div class="form-section">
                    <div class="section-header">
                        <div class="section-icon">
                            <svg class="icon" viewBox="0 0 24 24">
                                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                            </svg>
                        </div>
                        <h3>Basic Information</h3>
                    </div>
                    
                    <div class="form-grid">
                        <!-- Item Name -->
                        <div class="form-group full-width">
                            <label for="name" class="form-label">Item Name *</label>
                            <input type="text" name="name" id="name" value="{{ menu_item.name|default:'' }}" 
                                   class="form-input" placeholder="Enter item name" required>
                        </div>

                        <!-- Category -->
                        <div class="form-group">
                            <label for="category" class="form-label">Category *</label>
                            <select name="category" id="category" class="form-select" required>
                                <option value="">Select category</option>
                                {% for category in categories %}
                                <option value="{{ category.id }}" {% if menu_item.category_id == category.id %}selected{% endif %}>
                                    {{ category.name }}
                                </option>
                                {% endfor %}
                            </select>
                        </div>

                        <!-- Price -->
                        <div class="form-group">
                            <label for="price" class="form-label">Price *</label>
                            <div class="price-input-wrapper">
                                <span class="currency-symbol">$</span>
                                <input type="number" name="price" id="price" value="{{ menu_item.price|default:'' }}" 
                                       class="form-input price-input" placeholder="0.00" step="0.01" min="0" required>
                            </div>
                        </div>

                        <!-- Cuisine Type -->
                        <div class="form-group">
                            <label for="cuisine_type" class="form-label">Cuisine Type</label>
                            <select name="cuisine_type" id="cuisine_type" class="form-select">
                                {% for value, label in cuisine_choices %}
                                <option value="{{ value }}" {% if menu_item.cuisine_type == value %}selected{% endif %}>
                                    {{ label }}
                                </option>
                                {% endfor %}
                            </select>
                        </div>

                        <!-- Preparation Time -->
                        <div class="form-group">
                            <label for="preparation_time" class="form-label">Preparation Time (minutes)</label>
                            <input type="number" name="preparation_time" id="preparation_time" value="{{ menu_item.preparation_time|default:15 }}" 
                                   class="form-input" placeholder="15" min="0">
                        </div>
                    </div>
                </div>

                <!-- Description Section -->
                <div class="form-section">
                    <div class="section-header">
                        <div class="section-icon">
                            <svg class="icon" viewBox="0 0 24 24">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                <polyline points="14,2 14,8 20,8"/>
                                <line x1="16" y1="13" x2="8" y2="13"/>
                                <line x1="16" y1="17" x2="8" y2="17"/>
                                <polyline points="10,9 9,9 8,9"/>
                            </svg>
                        </div>
                        <h3>Description</h3>
                    </div>
                    
                    <div class="form-group">
                        <label for="description" class="form-label">Item Description</label>
                        <textarea name="description" id="description" rows="4" 
                                  class="form-textarea" placeholder="Enter detailed description of the item">{{ menu_item.description|default:'' }}</textarea>
                    </div>
                </div>

                <!-- Dietary Options Section -->
                <div class="form-section">
                    <div class="section-header">
                        <div class="section-icon">
                            <svg class="icon" viewBox="0 0 24 24">
                                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                            </svg>
                        </div>
                        <h3>Dietary Options</h3>
                    </div>
                    
                    <div class="checkbox-grid">
                        <div class="checkbox-item">
                            <input type="checkbox" name="is_vegetarian" id="is_vegetarian" 
                                   class="form-checkbox" {% if menu_item.is_vegetarian %}checked{% endif %}>
                            <label for="is_vegetarian" class="checkbox-label">
                                <span class="checkbox-icon">ü•¨</span>
                                Vegetarian
                            </label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" name="is_gluten_free" id="is_gluten_free" 
                                   class="form-checkbox" {% if menu_item.is_gluten_free %}checked{% endif %}>
                            <label for="is_gluten_free" class="checkbox-label">
                                <span class="checkbox-icon">üåæ</span>
                                Gluten Free
                            </label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" name="is_spicy" id="is_spicy" 
                                   class="form-checkbox" {% if menu_item.is_spicy %}checked{% endif %}>
                            <label for="is_spicy" class="checkbox-label">
                                <span class="checkbox-icon">üå∂Ô∏è</span>
                                Spicy
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Availability Section -->
                <div class="form-section">
                    <div class="section-header">
                        <div class="section-icon">
                            <svg class="icon" viewBox="0 0 24 24">
                                <path d="M9 12l2 2 4-4"/>
                                <path d="M21 12c-1 0-2-1-2-2s1-2 2-2 2 1 2 2-1 2-2 2z"/>
                                <path d="M3 12c1 0 2-1 2-2s-1-2-2-2-2 1-2 2 1 2 2 2z"/>
                                <path d="M12 3c0 1-1 2-2 2s-2-1-2-2 1-2 2-2 2 1 2 2z"/>
                                <path d="M12 21c0-1 1-2 2-2s2 1 2 2-1 2-2 2-2-1-2-2z"/>
                            </svg>
                        </div>
                        <h3>Availability</h3>
                    </div>
                    
                    <div class="form-group">
                        <div class="checkbox-item">
                            <input type="checkbox" name="is_available" id="is_available" 
                                   class="form-checkbox" {% if menu_item.is_available or not menu_item.pk %}checked{% endif %}>
                            <label for="is_available" class="checkbox-label">
                                <span class="checkbox-icon">‚úÖ</span>
                                Available for ordering
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Image Upload Section -->
                <div class="form-section">
                    <div class="section-header">
                        <div class="section-icon">
                            <svg class="icon" viewBox="0 0 24 24">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                                <circle cx="8.5" cy="8.5" r="1.5"/>
                                <polyline points="21,15 16,10 5,21"/>
                            </svg>
                        </div>
                        <h3>Item Image</h3>
                    </div>
                    
                    <div class="image-upload-container">
                        <div class="upload-area" id="uploadArea">
                            <div class="upload-content">
                                <svg class="upload-icon" viewBox="0 0 24 24">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                    <polyline points="7,10 12,15 17,10"/>
                                    <line x1="12" y1="15" x2="12" y2="3"/>
                                </svg>
                                <p class="upload-text">Click to upload or drag and drop</p>
                                <p class="upload-hint">PNG, JPG, JPEG up to 10MB</p>
                                <input id="image" name="image" type="file" class="file-input" accept="image/*">
                            </div>
                        </div>
                        
                        {% if menu_item.image %}
                        <div class="current-image">
                            <p class="current-image-label">Current Image:</p>
                            <img src="{{ menu_item.image.url }}" alt="Current Image" class="preview-image">
                        </div>
                        {% endif %}
                        
                        <div id="imagePreview" class="image-preview" style="display: none;">
                            <p class="preview-label">Preview:</p>
                            <img id="previewImg" src="" alt="Preview" class="preview-image">
                        </div>
                    </div>
                </div>

                <!-- Submit Buttons -->
                <div class="form-actions">
                    <a href="{% url 'restaurant:menu_list' %}" class="btn btn-outline">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M19 12H5M12 19l-7-7 7-7"/>
                        </svg>
                        <span>Cancel</span>
                    </a>
                    <button type="submit" class="btn btn-primary">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                            <polyline points="17,21 17,13 7,13 7,21"/>
                            <polyline points="7,3 7,8 15,8"/>
                        </svg>
                        <span>{% if menu_item.pk %}Update{% else %}Create{% endif %} Menu Item</span>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<style>
/* Form Header */
.form-header {
    background: linear-gradient(135deg, var(--color-card-background) 0%, var(--color-background-secondary) 100%);
    border-radius: var(--radius-lg);
    padding: var(--spacing-xl);
    margin-bottom: var(--spacing-xl);
    border: 1px solid var(--color-card-border);
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
}

.header-main {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: var(--spacing-xl);
}

.header-content {
    display: flex;
    flex-direction: column;
}

.header-title {
    font-size: 2rem;
    font-weight: var(--font-weight-bold);
    color: var(--color-foreground);
    margin: 0 0 var(--spacing-sm) 0;
}

.header-subtitle {
    color: var(--color-foreground-secondary);
    font-size: 1rem;
}

.header-actions {
    display: flex;
    gap: var(--spacing-md);
}

/* Form Container */
.form-container {
    background: var(--color-card-background);
    border: 1px solid var(--color-card-border);
    border-radius: var(--radius-lg);
    overflow: hidden;
    box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
}

.menu-form {
    padding: var(--spacing-xl);
}

/* Form Sections */
.form-section {
    margin-bottom: var(--spacing-xl);
    padding-bottom: var(--spacing-xl);
    border-bottom: 1px solid var(--color-card-border);
}

.form-section:last-child {
    border-bottom: none;
    margin-bottom: 0;
    padding-bottom: 0;
}

.section-header {
    display: flex;
    align-items: center;
    gap: var(--spacing-md);
    margin-bottom: var(--spacing-lg);
}

.section-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background: linear-gradient(135deg, var(--color-gold) 0%, #B8860B 100%);
    border-radius: var(--radius-md);
    color: white;
}

.section-header h3 {
    margin: 0;
    color: var(--color-foreground);
    font-weight: var(--font-weight-semibold);
    font-size: 1.25rem;
}

/* Form Grid */
.form-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: var(--spacing-lg);
}

.form-group {
    display: flex;
    flex-direction: column;
}

.form-group.full-width {
    grid-column: 1 / -1;
}

.form-label {
    color: var(--color-foreground);
    font-size: 0.875rem;
    font-weight: var(--font-weight-medium);
    margin-bottom: var(--spacing-sm);
}

.form-input,
.form-select,
.form-textarea {
    padding: var(--spacing-sm) var(--spacing-md);
    border: 1px solid var(--color-card-border);
    border-radius: var(--radius-md);
    background: var(--color-background-secondary);
    color: var(--color-foreground);
    font-size: 0.875rem;
    transition: all var(--transition-fast);
}

.form-input:focus,
.form-select:focus,
.form-textarea:focus {
    outline: none;
    border-color: var(--color-gold);
    box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.1);
}

.form-textarea {
    resize: vertical;
    min-height: 100px;
}

/* Price Input */
.price-input-wrapper {
    position: relative;
    display: flex;
    align-items: center;
}

.currency-symbol {
    position: absolute;
    left: var(--spacing-md);
    color: var(--color-foreground-secondary);
    font-weight: var(--font-weight-medium);
    z-index: 1;
}

.price-input {
    padding-left: calc(var(--spacing-md) + 1rem);
}

/* Checkbox Grid */
.checkbox-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: var(--spacing-md);
}

.checkbox-item {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
}

.form-checkbox {
    width: 18px;
    height: 18px;
    accent-color: var(--color-gold);
    cursor: pointer;
}

.checkbox-label {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    color: var(--color-foreground);
    font-size: 0.875rem;
    cursor: pointer;
    user-select: none;
}

.checkbox-icon {
    font-size: 1rem;
}

/* Image Upload */
.image-upload-container {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-lg);
}

.upload-area {
    border: 2px dashed var(--color-card-border);
    border-radius: var(--radius-lg);
    padding: var(--spacing-xl);
    text-align: center;
    transition: all var(--transition-fast);
    cursor: pointer;
    position: relative;
}

.upload-area:hover {
    border-color: var(--color-gold);
    background: var(--color-background-secondary);
}

.upload-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--spacing-md);
}

.upload-icon {
    width: 48px;
    height: 48px;
    color: var(--color-foreground-tertiary);
}

.upload-text {
    color: var(--color-foreground);
    font-weight: var(--font-weight-medium);
    margin: 0;
}

.upload-hint {
    color: var(--color-foreground-tertiary);
    font-size: 0.75rem;
    margin: 0;
}

.file-input {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    opacity: 0;
    cursor: pointer;
}

.current-image,
.image-preview {
    padding: var(--spacing-md);
    background: var(--color-background-secondary);
    border-radius: var(--radius-md);
    border: 1px solid var(--color-card-border);
}

.current-image-label,
.preview-label {
    color: var(--color-foreground);
    font-size: 0.875rem;
    font-weight: var(--font-weight-medium);
    margin: 0 0 var(--spacing-sm) 0;
}

.preview-image {
    max-width: 200px;
    height: auto;
    border-radius: var(--radius-md);
    border: 1px solid var(--color-card-border);
}

/* Form Actions */
.form-actions {
    display: flex;
    justify-content: flex-end;
    gap: var(--spacing-md);
    padding-top: var(--spacing-xl);
    border-top: 1px solid var(--color-card-border);
    margin-top: var(--spacing-xl);
}

/* Responsive Design */
@media (max-width: 768px) {
    .header-main {
        flex-direction: column;
        gap: var(--spacing-lg);
    }
    
    .header-title {
        font-size: 1.5rem;
    }
    
    .form-grid {
        grid-template-columns: 1fr;
    }
    
    .checkbox-grid {
        grid-template-columns: 1fr;
    }
    
    .form-actions {
        flex-direction: column;
    }
    
    .menu-form {
        padding: var(--spacing-lg);
    }
}
</style>

<script>
// File upload functionality
document.addEventListener('DOMContentLoaded', function() {
    const fileInput = document.getElementById('image');
    const uploadArea = document.getElementById('uploadArea');
    const imagePreview = document.getElementById('imagePreview');
    const previewImg = document.getElementById('previewImg');
    
    // Handle file selection
    fileInput.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                previewImg.src = e.target.result;
                imagePreview.style.display = 'block';
            };
            reader.readAsDataURL(file);
        }
    });
    
    // Drag and drop functionality
    uploadArea.addEventListener('dragover', function(e) {
        e.preventDefault();
        uploadArea.style.borderColor = 'var(--color-gold)';
        uploadArea.style.background = 'var(--color-background-secondary)';
    });
    
    uploadArea.addEventListener('dragleave', function(e) {
        e.preventDefault();
        uploadArea.style.borderColor = 'var(--color-card-border)';
        uploadArea.style.background = 'transparent';
    });
    
    uploadArea.addEventListener('drop', function(e) {
        e.preventDefault();
        uploadArea.style.borderColor = 'var(--color-card-border)';
        uploadArea.style.background = 'transparent';
        
        const files = e.dataTransfer.files;
        if (files.length > 0) {
            fileInput.files = files;
            fileInput.dispatchEvent(new Event('change'));
        }
    });
});
</script>
{% endblock %} 