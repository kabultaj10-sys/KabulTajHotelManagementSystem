{% extends 'base.html' %}

{% block title %}Bookings - Kabul Taj Hotel{% endblock %}

{% block content %}
<!-- Enhanced Header -->
<div class="hotel-header">
	<div class="header-main">
		<div  class="header-content">
			<h1 class="header-title">Booking Management</h1>
			<p  class="subtitle-text header-subtitle">Manage reservations, check-ins, check-outs, rooms, and conferences</p>
		</div>

		<div class="header-actions">
			
			<a href="{% url 'booking_create' %}" class="btn btn-primary">
				<svg class="icon" viewBox="0 0 24 24">
					<path d="M12 5v14M5 12h14"/>
				</svg>
				<span>New Booking</span>
			</a>
		</div>
	</div>

	<div class="nav-tabs-container">
		<div class="nav-tabs">
			<a href="{% url 'booking_list' %}" class="nav-tab{% if request.resolver_match.url_name == 'booking_list' %} active{% endif %}">
				<svg class="icon" viewBox="0 0 24 24">
					<rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
					<line x1="16" y1="2" x2="16" y2="6"/>
					<line x1="8" y1="2" x2="8" y2="6"/>
					<line x1="3" y1="10" x2="21" y2="10"/>
				</svg>
				<span>Bookings</span>
			</a>
			
			<a href="{% url 'room_list' %}" class="nav-tab{% if request.resolver_match.url_name == 'room_list' %} active{% endif %}">
				<svg class="icon" viewBox="0 0 24 24">
					<path d="M2 4v16"/>
					<path d="M2 8h18a2 2 0 0 1 2 2v10"/>
					<path d="M2 17h20"/>
					<path d="M6 8v9"/>
				</svg>
				<span>Rooms</span>
			</a>
			
			<a href="{% url 'conference:conference_list' %}" class="nav-tab{% if request.resolver_match.app_name == 'conference' %} active{% endif %}">
				<svg class="icon" viewBox="0 0 24 24">
					<path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
					<circle cx="9" cy="7" r="4"/>
					<path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
					<path d="M16 3.13a4 4 0 0 1 0 7.75"/>
				</svg>
				<span>Conferences</span>
			</a>
		</div>
	</div>
</div>

<!-- Booking Stats -->
<div class="stats-grid">
	<div class="stat-card">
		<div class="stat-icon gold">
			<i class="fas fa-calendar-check"></i>
		</div>
		<div class="stat-number">{{ stats.total|default:0 }}</div>
		<div class="stat-label">Total Bookings</div>
	</div>
	
	<div class="stat-card">
		<div class="stat-icon" style="background-color: var(--color-success); color: white;">
			<i class="fas fa-user-check"></i>
		</div>
		<div class="stat-number">{{ stats.active|default:0 }}</div>
		<div class="stat-label">Active</div>
	</div>
	
	<div class="stat-card">
		<div class="stat-icon" style="background-color: var(--color-warning); color: white;">
			<i class="fas fa-clock"></i>
		</div>
		<div class="stat-number">{{ stats.pending|default:0 }}</div>
		<div class="stat-label">Pending</div>
	</div>
	
	<div class="stat-card">
		<div class="stat-icon" style="background-color: var(--color-info); color: white;">
			<i class="fas fa-door-open"></i>
		</div>
		<div class="stat-number">{{ stats.today_checkins|default:0 }}</div>
		<div class="stat-label">Today's Check-ins</div>
	</div>
</div>

<!-- Search and Filters -->
<div class="card">
	<div style="display: flex; flex-direction: column; gap: var(--spacing-md);">
		<h3 style="font-size: 1.25rem; font-weight: var(--font-weight-semibold); color: var(--color-foreground);">
			Search & Filters
		</h3>
		
		<form method="get" style="display: flex; flex-wrap: wrap; gap: var(--spacing-md); align-items: center;">
			<div style="position: relative; flex: 1; min-width: 200px;">
				<input type="text" name="guest_search" value="{{ guest_search }}" 
					   placeholder="Search guest name or email..." 
					   style="width: 100%; padding: var(--spacing-sm) var(--spacing-md); background-color: var(--color-input-background); border: 1px solid var(--color-input-border); border-radius: var(--radius-md); color: var(--color-foreground); font-size: 0.875rem;">
			</div>
			
			<select name="status" style="padding: var(--spacing-sm) var(--spacing-md); background-color: var(--color-input-background); border: 1px solid var(--color-input-border); border-radius: var(--radius-md); color: var(--color-foreground); font-size: 0.875rem; min-width: 150px;">
				<option value="">All Status</option>
				<option value="pending" {% if status_filter == 'pending' %}selected{% endif %}>Pending</option>
				<option value="confirmed" {% if status_filter == 'confirmed' %}selected{% endif %}>Confirmed</option>
				<option value="active" {% if status_filter == 'active' %}selected{% endif %}>Active</option>
				<option value="completed" {% if status_filter == 'completed' %}selected{% endif %}>Completed</option>
				<option value="cancelled" {% if status_filter == 'cancelled' %}selected{% endif %}>Cancelled</option>
				<option value="no_show" {% if status_filter == 'no_show' %}selected{% endif %}>No Show</option>
			</select>
			
			<select name="date_filter" style="padding: var(--spacing-sm) var(--spacing-md); background-color: var(--color-input-background); border: 1px solid var(--color-input-border); border-radius: var(--radius-md); color: var(--color-foreground); font-size: 0.875rem; min-width: 150px;">
				<option value="">All Dates</option>
				<option value="today" {% if date_filter == 'today' %}selected{% endif %}>Today</option>
				<option value="tomorrow" {% if date_filter == 'tomorrow' %}selected{% endif %}>Tomorrow</option>
				<option value="this_week" {% if date_filter == 'this_week' %}selected{% endif %}>This Week</option>
				<option value="overdue" {% if date_filter == 'overdue' %}selected{% endif %}>Overdue</option>
			</select>
			
			<button type="submit" class="btn btn-primary">
				<i class="fas fa-search"></i>
				Search
			</button>
		</form>
	</div>
</div>

<!-- Bookings Table -->
<div class="card">
	<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-lg);">
		<h3 style="font-size: 1.25rem; font-weight: var(--font-weight-semibold); color: var(--color-foreground);">
			All Bookings
		</h3>
	</div>
	
	<div style="overflow-x: auto;">
		<table style="width: 100%; border-collapse: collapse;">
			<thead>
				<tr style="border-bottom: 1px solid var(--color-card-border);">
					<th style="text-align: left; padding: var(--spacing-md); font-weight: var(--font-weight-semibold); color: var(--color-foreground); font-size: 0.875rem;">Booking</th>
					<th style="text-align: left; padding: var(--spacing-md); font-weight: var(--font-weight-semibold); color: var(--color-foreground); font-size: 0.875rem;">Guest</th>
					<th style="text-align: left; padding: var(--spacing-md); font-weight: var(--font-weight-semibold); color: var(--color-foreground); font-size: 0.875rem;">Room</th>
					<th style="text-align: left; padding: var(--spacing-md); font-weight: var(--font-weight-semibold); color: var(--color-foreground); font-size: 0.875rem;">Dates</th>
					<th style="text-align: left; padding: var(--spacing-md); font-weight: var(--font-weight-semibold); color: var(--color-foreground); font-size: 0.875rem;">Amount</th>
					<th style="text-align: left; padding: var(--spacing-md); font-weight: var(--font-weight-semibold); color: var(--color-foreground); font-size: 0.875rem;">Status</th>
					<th style="text-align: left; padding: var(--spacing-md); font-weight: var(--font-weight-semibold); color: var(--color-foreground); font-size: 0.875rem;">Actions</th>
				</tr>
			</thead>
			<tbody>
				{% for booking in bookings %}
				<tr style="border-bottom: 1px solid var(--color-card-border); transition: all var(--transition-fast);">
					<td style="padding: var(--spacing-md);">
						<div style="font-weight: var(--font-weight-medium); color: var(--color-foreground); font-size: 0.875rem;">
							{{ booking.booking_number }}
						</div>
						<div style="color: var(--color-foreground-secondary); font-size: 0.75rem;">
							{{ booking.created_at|date:"M d, Y H:i" }}
						</div>
					</td>
					<td style="padding: var(--spacing-md);">
						<div style="display: flex; align-items: center; gap: var(--spacing-sm);">
							<div style="width: 2rem; height: 2rem; background-color: var(--color-gold); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--color-gold-foreground); font-weight: var(--font-weight-semibold); font-size: 0.75rem;">
								{{ booking.guest.first_name|first }}{{ booking.guest.last_name|first }}
							</div>
							<div>
								<div style="font-weight: var(--font-weight-medium); color: var(--color-foreground); font-size: 0.875rem;">
									{{ booking.guest.full_name }}
								</div>
								<div style="color: var(--color-foreground-secondary); font-size: 0.75rem;">
									{{ booking.guest.email }}
								</div>
							</div>
						</div>
					</td>
					<td style="padding: var(--spacing-md);">
						<div style="font-weight: var(--font-weight-medium); color: var(--color-foreground); font-size: 0.875rem;">
							Room {{ booking.room.room_number }}
						</div>
						<div style="color: var(--color-foreground-secondary); font-size: 0.75rem;">
							{{ booking.room.room_type.name }}
						</div>
					</td>
					<td style="padding: var(--spacing-md);">
						<div style="color: var(--color-foreground); font-size: 0.875rem;">
							{{ booking.check_in_date|date:"M d, Y" }}
						</div>
						<div style="color: var(--color-foreground-secondary); font-size: 0.75rem;">
							to {{ booking.check_out_date|date:"M d, Y" }}
						</div>
						<div style="color: var(--color-foreground-tertiary); font-size: 0.75rem;">
							{{ booking.duration }} nights
						</div>
					</td>
					<td style="padding: var(--spacing-md);">
						<div style="font-weight: var(--font-weight-semibold); color: var(--color-foreground); font-size: 0.875rem;">
							${{ booking.total_amount }}
						</div>
						<div style="color: var(--color-foreground-secondary); font-size: 0.75rem;">
							${{ booking.room_rate }}/night
						</div>
					</td>
					<td style="padding: var(--spacing-md);">
						<span style="padding: 0.25rem 0.5rem; border-radius: var(--radius-sm); font-size: 0.75rem; font-weight: var(--font-weight-medium);
							{% if booking.status == 'confirmed' %}background-color: var(--color-info-light); color: var(--color-info);
							{% elif booking.status == 'pending' %}background-color: var(--color-warning-light); color: var(--color-warning);
							{% elif booking.status == 'active' %}background-color: var(--color-success-light); color: var(--color-success);
							{% elif booking.status == 'completed' %}background-color: var(--color-gold-light); color: var(--color-gold);
							{% elif booking.status == 'cancelled' %}background-color: var(--color-danger-light); color: var(--color-danger);
							{% elif booking.status == 'no_show' %}background-color: var(--color-danger-light); color: var(--color-danger);
							{% else %}background-color: var(--color-background-tertiary); color: var(--color-foreground-secondary);{% endif %}">
							{{ booking.get_status_display }}
						</span>
					</td>
					<td style="padding: var(--spacing-md);">
						<div style="display: flex; gap: var(--spacing-sm);">
							<a href="{% url 'booking_detail' booking.pk %}" style="color: var(--color-success); text-decoration: none; padding: var(--spacing-xs); border-radius: var(--radius-sm); transition: all var(--transition-fast);" title="View Details">
								<i class="fas fa-eye"></i>
							</a>
							<a href="{% url 'booking_edit' booking.pk %}" style="color: var(--color-info); text-decoration: none; padding: var(--spacing-xs); border-radius: var(--radius-sm); transition: all var(--transition-fast);" title="Edit">
								<i class="fas fa-edit"></i>
							</a>
							{% if booking.status == 'confirmed' %}
							<a href="{% url 'check_in_create' booking.pk %}" style="color: var(--color-success); text-decoration: none; padding: var(--spacing-xs); border-radius: var(--radius-sm); transition: all var(--transition-fast);" title="Check In">
								<i class="fas fa-sign-in-alt"></i>
							</a>
							{% endif %}
							{% if booking.status == 'active' %}
							<a href="{% url 'check_out_create' booking.pk %}" style="color: var(--color-warning); text-decoration: none; padding: var(--spacing-xs); border-radius: var(--radius-sm); transition: all var(--transition-fast);" title="Check Out">
								<i class="fas fa-sign-out-alt"></i>
							</a>
							{% endif %}
							<a href="{% url 'booking_delete' booking.pk %}" style="color: var(--color-danger); text-decoration: none; padding: var(--spacing-xs); border-radius: var(--radius-sm); transition: all var(--transition-fast);" title="Delete">
								<i class="fas fa-trash"></i>
							</a>
						</div>
					</td>
				</tr>
				{% empty %}
				<tr>
					<td colspan="7" style="padding: var(--spacing-xl); text-align: center; color: var(--color-foreground-secondary);">
						No bookings found. <a href="{% url 'booking_create' %}" style="color: var(--color-gold); text-decoration: none;">Create your first booking</a>
					</td>
				</tr>
				{% endfor %}
			</tbody>
		</table>
	</div>
</div>






<!--   -->








<script>
function checkIn(bookingId) {
	if (confirm('Confirm check-in for this booking?')) {
		window.location.href = `/bookings/${bookingId}/check-in/`;
	}
}

function checkOut(bookingId) {
	if (confirm('Confirm check-out for this booking?')) {
		window.location.href = `/bookings/${bookingId}/check-out/`;
	}
}
</script>
{% endblock %}

 